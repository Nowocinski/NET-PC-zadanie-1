<div>
  @if (!isAuthenticated()) {
    <button (click)="goToLogin()">Go to Login</button>
  }

  <h2>Contacts</h2>

  @if (isAuthenticated()) {
    <button (click)="showAddContactForm()">Add New Contact</button>
  }

  @if (showAddForm()) {
    <div>
      <h3>Add New Contact</h3>
      <form (ngSubmit)="addContact()">
        <div>
          <label for="firstName">First Name:</label>
          <input type="text" id="firstName" name="firstName" [(ngModel)]="newContact.firstName" required />
        </div>

        <div>
          <label for="lastName">Last Name:</label>
          <input type="text" id="lastName" name="lastName" [(ngModel)]="newContact.lastName" required />
        </div>

        <div>
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" [(ngModel)]="newContact.email" required />
        </div>

        <div>
          <label for="phone">Phone:</label>
          <input type="tel" id="phone" name="phone" [(ngModel)]="newContact.phone" required />
        </div>

        <div>
          <label for="birthDate">Birth Date:</label>
          <input type="date" id="birthDate" name="birthDate" [(ngModel)]="newContact.birthDate" required />
        </div>

        <div>
          <label for="password">Password:</label>
          <input type="password" id="password" name="password" [(ngModel)]="newContact.password" required />
        </div>

        <div>
          <label for="category">Category:</label>
          <select id="category" name="category" [(ngModel)]="newContact.categoryId">
            <option value="">-- Select Category --</option>
            @for (category of categories(); track category.id) {
              <option [value]="category.id">{{ category.name }}</option>
            }
          </select>
        </div>
        
        @if (isSluzbowyCategory(newContact.categoryId)) {
          <div>
            <label for="subcategory">Subcategory:</label>
            <select id="subcategory" name="subcategory" [(ngModel)]="newContact.subcategoryId">
              <option value="">-- Select Subcategory --</option>
              @for (subcategory of subcategories(); track subcategory.id) {
                <option [value]="subcategory.id">{{ subcategory.name }}</option>
              }
            </select>
          </div>
        }
        
        <button type="submit">Save</button>
        <button type="button" (click)="hideAddContactForm()">Cancel</button>
      </form>
    </div>
  }

  @if (showEditForm()) {
    <div>
      <h3>Edit Contact</h3>
      <form (ngSubmit)="updateContact()">
        <div>
          <label for="editFirstName">First Name:</label>
          <input type="text" id="editFirstName" name="editFirstName" [(ngModel)]="editContactData.firstName" required />
        </div>

        <div>
          <label for="editLastName">Last Name:</label>
          <input type="text" id="editLastName" name="editLastName" [(ngModel)]="editContactData.lastName" required />
        </div>

        <div>
          <label for="editEmail">Email:</label>
          <input type="email" id="editEmail" name="editEmail" [(ngModel)]="editContactData.email" required />
        </div>

        <div>
          <label for="editPhone">Phone:</label>
          <input type="tel" id="editPhone" name="editPhone" [(ngModel)]="editContactData.phone" required />
        </div>

        <div>
          <label for="editBirthDate">Birth Date:</label>
          <input type="date" id="editBirthDate" name="editBirthDate" [(ngModel)]="editContactData.birthDate" required />
        </div>

        <div>
          <label for="editPassword">Password:</label>
          <input type="password" id="editPassword" name="editPassword" [(ngModel)]="editContactData.password" required />
        </div>

        <div>
          <label for="editCategory">Category:</label>
          <select id="editCategory" name="editCategory" [(ngModel)]="editContactData.categoryId">
            <option value="">-- Select Category --</option>
            @for (category of categories(); track category.id) {
              <option [value]="category.id">{{ category.name }}</option>
            }
          </select>
        </div>
        
        @if (isSluzbowyCategory(editContactData.categoryId)) {
          <div>
            <label for="editSubcategory">Subcategory:</label>
            <select id="editSubcategory" name="editSubcategory" [(ngModel)]="editContactData.subcategoryId">
              <option value="">-- Select Subcategory --</option>
              @for (subcategory of subcategories(); track subcategory.id) {
                <option [value]="subcategory.id">{{ subcategory.name }}</option>
              }
            </select>
          </div>
        }
        
        <button type="submit">Update</button>
        <button type="button" (click)="hideEditContactForm()">Cancel</button>
      </form>
    </div>
  }

  @if (isLoading()) {
    <p>Loading contacts...</p>
  }

  @if (errorMessage()) {
    <p>{{ errorMessage() }}</p>
  }

  @if (!isLoading() && contacts().length === 0) {
    <p>No contacts found.</p>
  }

  @if (!isLoading() && contacts().length > 0) {
    <ul>
      @for (contact of contacts(); track contact.id) {
        <li>
          <span (click)="selectContact(contact)" style="cursor: pointer;">
            {{ contact.firstName }} {{ contact.lastName }}
          </span>
          @if (isAuthenticated()) {
            <button (click)="showEditContactForm(contact)">Edit</button>
            <button (click)="deleteContact(contact.id)">Delete</button>
          }
        </li>
      }
    </ul>
  }

  @if (selectedContact()) {
    <div>
      <h3>Contact Details</h3>
      <p><strong>ID:</strong> {{ selectedContact()!.id }}</p>
      <p><strong>First Name:</strong> {{ selectedContact()!.firstName }}</p>
      <p><strong>Last Name:</strong> {{ selectedContact()!.lastName }}</p>
      <p><strong>Email:</strong> {{ selectedContact()!.email }}</p>
      <p><strong>Phone:</strong> {{ selectedContact()!.phone }}</p>
      <p><strong>Birth Date:</strong> {{ selectedContact()!.birthDate }}</p>
      <p><strong>User ID:</strong> {{ selectedContact()!.userId }}</p>
      @if (selectedContact()!.categoryId) {
        <p><strong>Category ID:</strong> {{ selectedContact()!.categoryId }}</p>
      }
      @if (selectedContact()!.subcategoryId) {
        <p><strong>Subcategory ID:</strong> {{ selectedContact()!.subcategoryId }}</p>
      }
      <button (click)="closeDetails()">Close</button>
    </div>
  }
</div>
